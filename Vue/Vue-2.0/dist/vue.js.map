{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["\r\nclass Observe{\r\n    constructor(data) {\r\n        // Object.definProperty 只能劫持已经存在的属性 (vue 为此单独写api $set $delete);\r\n        this.walk(data)\r\n    }\r\n    walk(data) { //循环注册对象属性（劫持属性）\r\n        // 重新定义属性 （—性能瓶颈）\r\n        Object.keys(data).forEach(key =>defineReactive(data, key, data[key]))\r\n    }\r\n}\r\n\r\nexport function defineReactive(target, key, value) {\r\n    observe(value);\r\n    Object.defineProperty(target, key, {\r\n        get() { \r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if(newValue === value) return;\r\n            value =  newValue\r\n        }\r\n    })\r\n}\r\n\r\n\r\n\r\nexport function observe(data) {\r\n    // 对对象劫持\r\n\r\n    if(typeof data !== \"object\" || data == null){\r\n        return; //只劫持对象\r\n    }\r\n    // 被劫持过了，就不需要劫持 （判断对象是否被劫持，添加实例，用实例判断是否被劫持）\r\n\r\n\r\n    return new Observe(data)\r\n}","import { observe } from \"./observe/index\";\r\n\r\nfunction initState(vm) {\r\n    const opts = vm.$options;\r\n    if(opts.data) {\r\n        // 初始化数据\r\n        initData(vm)\r\n    }\r\n}\r\nfunction proxy(vm, target, key) {\r\n    Object.defineProperty(vm, key,{\r\n        // 从_dataz中的数据挂在vm上\r\n        get() {\r\n            return vm[target][key];\r\n        },\r\n        set(newValue) {\r\n            return vm[target][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data; //data可能是函数  可能是对象；\r\n    data = typeof data === \"function\" ? data.call(vm) : data;\r\n\r\n\r\n    vm._data = data; \r\n    \r\n    // 数据劫持 代理1\r\n    observe(data);\r\n    // vm._data 代理到vm上 保持vms实例上的data响应式变化 代理2\r\n    for(let key in data) {\r\n        proxy(vm, \"_data\", key)\r\n    }\r\n}\r\n\r\nexport { initState, initData }","\r\nimport { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n\r\n    Vue.prototype._init = function(options){\r\n        // vue 指令 vm vm\r\n        const vm = this;\r\n        vm.$options = options;\r\n        // 初始化状态\r\n        initState(vm);\r\n    }\r\n}\r\n\r\n    // function initState(vm) {\r\n    //     const opts = vm.$options;\r\n    //     if(opts.data) {\r\n    //         initData(vm)\r\n    //     }\r\n    // }\r\n    // function initData(vm) {\r\n    //     let data = vm.$option.data; //data可能是函数  可能是对象；\r\n    //     data = typeof data === \"function\" ? data.call(vm) : data;\r\n\r\n    // }","\r\nimport { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue;"],"names":["Observe","data","walk","Object","keys","forEach","key","defineReactive","target","value","observe","defineProperty","get","set","newValue","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}